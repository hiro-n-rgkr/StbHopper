"use strict";(self.webpackChunkhoaryfox_website=self.webpackChunkhoaryfox_website||[]).push([[2947],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return h}});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=d(e.components);return o.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(t),h=i,p=u["".concat(l,".").concat(h)]||u[h]||m[h]||a;return t?o.createElement(p,r(r({ref:n},c),{},{components:t})):o.createElement(p,r({ref:n},c))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,r=new Array(a);r[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var d=2;d<a;d++)r[d]=t[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8161:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return m}});var o=t(7462),i=t(3366),a=(t(7294),t(3905)),r=["components"],s={id:"GetModelData",title:"Get model data & draw"},l=void 0,d={unversionedId:"Coding/GetModelData",id:"Coding/GetModelData",title:"Get model data & draw",description:"In this section, we will show you how to get nodal and member information and export the lines and their information in Rhino.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/Coding/GetModelData.md",sourceDirName:"Coding",slug:"/Coding/GetModelData",permalink:"/HoaryFox/en/docs/Coding/GetModelData",editUrl:"https://github.com/hrntsm/HoaryFox/edit/develop/website/docs/Coding/GetModelData.md",tags:[],version:"current",frontMatter:{id:"GetModelData",title:"Get model data & draw"},sidebar:"Sidebar",previous:{title:"Getting Start",permalink:"/HoaryFox/en/docs/Coding/GettingStartSTBCoding"},next:{title:"Changelog",permalink:"/HoaryFox/en/docs/Changelog"}},c={},m=[{value:"About the structure of ST-Bridge data",id:"about-the-structure-of-st-bridge-data",level:2},{value:"Get nodal information",id:"get-nodal-information",level:2},{value:"Drawing with Point3d",id:"drawing-with-point3d",level:3},{value:"Getting member information",id:"getting-member-information",level:2},{value:"Drawing with Line",id:"drawing-with-line",level:3},{value:"Get section information for a part",id:"get-section-information-for-a-part",level:3},{value:"Create C# Script Component",id:"create-c-script-component",level:2}],u={toc:m};function h(e){var n=e.components,s=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,o.Z)({},u,s,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In this section, we will show you how to get nodal and member information and export the lines and their information in Rhino."),(0,a.kt)("h2",{id:"about-the-structure-of-st-bridge-data"},"About the structure of ST-Bridge data"),(0,a.kt)("p",null,'First of all, I would like to briefly explain the data structure of ST-Bridge in order to make it easier to find where the information is.\nThe basic image of ST-Bridge data structure is as follows: "There are nodes, beams between the nodes, and cross-sectional information on the beams.'),(0,a.kt)("p",null,"For example, the model position and cross-section information is contained in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbModel"),", which is structured as follows.\nYou can use ",(0,a.kt)("inlineCode",{parentName:"p"},"StbMember")," to get the information of a part, and ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSections")," to get the information of a section."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ST_BRIDGE\n\u2514\u2500\u2500\u2500StbModel\n    \u251c\u2500\u2500\u2500StbAxes\n    \u251c\u2500\u2500\u2500StbJoints\n    \u251c\u2500\u2500\u2500StbMembers\n    \u251c\u2500\u2500\u2500StbNodes\n    \u251c\u2500\u2500\u2500StbSections\n    \u2514\u2500\u2500\u2500StbStories\n")),(0,a.kt)("p",null,"The reference between each data is done by id.",(0,a.kt)("br",{parentName:"p"}),"\n","For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"column A")," is connected to ",(0,a.kt)("inlineCode",{parentName:"p"},"nodes 1-2")," and has a cross section of ",(0,a.kt)("inlineCode",{parentName:"p"},"section number 5"),".\nSo, if you want to know the nodal coordinates of column A, you have to find the ones with id 1 and 2 in StbNodes, and if you want to know the cross section, you have to find the one with id 5 in StbSections."),(0,a.kt)("p",null,"One thing that is a bit confusing is which floor and axis the member belongs to.",(0,a.kt)("br",{parentName:"p"}),"\n","In ST-Bridge data, members do not have any axis or floor information.\nAll the nodes belong somewhere, so you get the floor and axis information of the member by getting the values from the nodes that belong to the member."),(0,a.kt)("h2",{id:"get-nodal-information"},"Get nodal information"),(0,a.kt)("p",null,"Get a list of nodes, which are the most basic elements of a part.",(0,a.kt)("br",{parentName:"p"}),"\n","You can get the node information from ",(0,a.kt)("a",{parentName:"p",href:"https://hiron.dev/STBDotNet/docs/STBDotNet.v202.StbNode.html"},"StbNode"),", which is returned as an array from ",(0,a.kt)("inlineCode",{parentName:"p"},"StbNodes"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"StbNode[] nodes = model.StbModel.StbNodes;\n")),(0,a.kt)("p",null,'StbNode is a class that holds the id and coordinate information of nodes.\nThe specification does not require that the array index and the StbNode\'s id match, so be sure to use the id when referring to a node of a member.\nFor example, to retrieve a node with an id of "1", you can write the following using Linq'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs",metastring:"{1,4}","{1,4}":!0},'// using System.Linq\nStbNode[] nodes = model.StbModel.StbNodes;\nStbNode node1 = nodes.FirstOrDefault(n => n.id == "1");\n')),(0,a.kt)("p",null,"FirstOrDefault is a method that returns the first value from the array for which the condition is true, or Default if not found (or null if not specified)."),(0,a.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Note that the id is often given as a number, but the format of the data is a string."))),(0,a.kt)("h3",{id:"drawing-with-point3d"},"Drawing with Point3d"),(0,a.kt)("p",null,"If you want to visualize it as Rhino's Point3d, you can create a Point3d array from the obtained nodal information as follows.\nIf you are using a console application, please refer to Rhino3dm instead of RhinoCommon."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs",metastring:"{4}","{4}":!0},"// using System.Linq\nStbNode[] nodes = model.StbModel.StbNodes;\nPoint3d[] pts = nodes.Select(n => new Point3d(n.x, n.y, n.z)).ToArray();\n")),(0,a.kt)("p",null,"Now that we have the list of nodes, let's get the member information."),(0,a.kt)("h2",{id:"getting-member-information"},"Getting member information"),(0,a.kt)("p",null,"In this section, we will show you how to get the information of a column among the members as an example.\nThe column information is in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbColumn"),", so we will get its value."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"StbColumn[] columns = model.StbModel.StbColumns;\n")),(0,a.kt)("p",null,"To find out what value ",(0,a.kt)("inlineCode",{parentName:"p"},"StbColumn")," should have, please refer to the specification document or the STBDotNet documentation below."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://hiron.dev/STBDotNet/docs/STBDotNet.v202.StbColumn.html"},"StbColumn document page"))),(0,a.kt)("h3",{id:"drawing-with-line"},"Drawing with Line"),(0,a.kt)("p",null,"If there are no intermediate nodes, there will be two nodes, ",(0,a.kt)("inlineCode",{parentName:"p"},"id_node_bottom")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"id_node_top"),".\nYou can get the id obtained from these two, and get the nodal coordinates from the nodal id information as in the previous section."),(0,a.kt)("p",null,"Once we have the start and end points of the member, we can use them to create the line of the member."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"StbNode[] nodes = model.StbModel.StbNodes;\nStbColumn[] columns = model.StbModel.StbMembers.StbColumns;\n\nvar pts = new Point3d[columns.length, 2];\n\nforeach ((StbColumn column, int i) in columns.Select((column, index) => (column, index)))\n{\n    StbNode nodeStart = nodes.FirstOrDefault(n => n.id == column.id_node_bottom);\n    StbNode nodeEnd = nodes.FirstOrDefault(n => n.id == column.id_node_top);\n\n    pts[i, 0] = new Point3d(nodeStart.X, nodeStart.Y, nodeStart.Z);\n    pts[i, 1] = new Point3d(nodeEnd.X, nodeEnd.Y, nodeEnd.Z);\n\n    lines[i] = new Line(pts[i, 0], pts[i, 1]);\n}\n")),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If you want to draw the member more accurately, for example, StbColumn contains offset and rotate properties, which can be reflected in the end node coordinates to take into account the offset and rotation of the column."))),(0,a.kt)("h3",{id:"get-section-information-for-a-part"},"Get section information for a part"),(0,a.kt)("p",null,"The code of a part can be obtained from the ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," property.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},"name")," property can be used to obtain the sign of the part. The name depends on the exporting software, but it can be a name expressed as floor + sign, such as 2C1.\nIt is the name of the member, not the cross section."),(0,a.kt)("p",null,"Information about the cross section shape can be obtained from the ",(0,a.kt)("inlineCode",{parentName:"p"},"id_section")," property.\nAs in the case of nodes, this is a string that represents the id in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSections")," that has the actual section information."),(0,a.kt)("p",null,"These can be obtained as follows, as in the case of nodes above."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"var names = new string[columns.Length];\nvar idSection = new string[columns.Length];\n\nforeach ((StbColumn column, int i) in columns.Select((column, index) => (column, index)))\n{\n    names[i] = column.name;\n    idSection[i] = column.id_section;\n}\n")),(0,a.kt)("p",null,"The cross-sectional information is organized as follows.\nAlthough omitted, the cross-sectional information is maintained for each structural type of each part."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ST_BRIDGE\n\u2514\u2500\u2500\u2500StbSections\n    \u251c\u2500\u2500\u2500StbSecColumn_RC\n    \u251c\u2500\u2500\u2500StbSecColumn_S\n    \u251c\u2500\u2500\u2500StbSecColumn_SRC\n    \u251c\u2500\u2500\u2500StbSecColumn_CFT\n    \u251c\u2500\u2500\u2500StbSecBeam_RC\n    \u251c\u2500\u2500\u2500StbSecBeam_S\n    \u251c\u2500\u2500\u2500StbSecBeam_SRC\n    \u251c\u2500\u2500\u2500StbSecBrace_S\n    \u251c\u2500\u2500\u2500StbSecSteel\n    ...\n")),(0,a.kt)("p",null,"The id retrieved by ",(0,a.kt)("inlineCode",{parentName:"p"},"id_section")," is unique in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSections"),". Therefore, we need to check if the corresponding id exists in each class."),(0,a.kt)("p",null,"In the case of a column, it looks like the following."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"var sectionNames = new string[columns.Length];\nStbSections sections = model.StbModel.StbSections;\n\nforeach ((string id, int i) in idSection.Select((id, index) => (id, index)))\n{\n    var hasName = false;\n\n    if (sections.StbSecColumn_RC != null)\n    {\n        foreach (StbSecColumn_RC columnRc in sections.StbSecColumn_RC)\n        {\n            if (columnRc.id != id) continue;\n            sectionNames[i] = columnRc.name;\n            hasName = true;\n            break;\n        }\n    }\n\n    if (sections.StbSecColumn_S != null && !hasName)\n    {\n        foreach (StbSecColumn_S columnS in sections.StbSecColumn_S)\n        {\n            if (columnS.id != id) continue;\n            sectionNames[i] = columnS.name;\n            break;\n        }\n    }\n}\n")),(0,a.kt)("p",null,"Since we don't know where the id corresponds to until we check it, we need to check it one by one as shown above."),(0,a.kt)("p",null,"Although not used this time, the structure type can be obtained by ",(0,a.kt)("inlineCode",{parentName:"p"},"kind_structure")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbColumn"),", so you can determine in advance which structure type is used for the XX part of StbSecColum_XX."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"RC members such as ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSecXXX_RC")," contain information such as the outline of the cross-section and reinforcement, but steel members such as ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSecXXX_S")," can only get the shape name of the cross-section (e.g. H-300x150x10x15), not the specific shape information.",(0,a.kt)("br",{parentName:"p"}),"\n","Specific cross-sectional information for steel members is contained in ",(0,a.kt)("inlineCode",{parentName:"p"},"StbSecSteel"),". It is necessary to find a child element of StbSecSteel that has a shape name that matches the shape name of the obtained cross section, using the same concept as the id of nodes, etc. Steel frames require a little more work than RC."))),(0,a.kt)("h2",{id:"create-c-script-component"},"Create C# Script Component"),(0,a.kt)("p",null,"Based on what we have learned so far, we will create a component that can be used to tag lines in Grasshopper."),(0,a.kt)("p",null,"We will use the TextTag component for the tagging itself, and write a C# Script component that outputs the string to be tagged and the Line to which it will be attached."),(0,a.kt)("p",null,"The contents of the component should look like this The content of the component should be as follows, based on what we have written so far."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs",metastring:"title=C#Script_Component",title:"C#Script_Component"},"using System.Linq;\nusing STBDotNet.Serialization;\nusing STBDotNet.v202;\nusing Version = STBDotNet.Enums.Version;\n\npublic class Script_Instance: GH_ScriptInstance\n{\n    private void RunScript(string path, ref object pt, ref object line, ref object name)\n    {\n        var model = Serializer.Deserialize(path, Version.Stb202) as ST_BRIDGE;\n\n        StbNode[] nodes = model.StbModel.StbNodes;\n        StbColumn[] columns = model.StbModel.StbMembers.StbColumns;\n\n        var pts = new Point3d[columns.Length, 2];\n        var lines = new Line[columns.Length];\n        var idSection = new string[columns.Length];\n        var sectionNames = new string[columns.Length];\n\n        for (var i = 0; i < columns.Length; i++)\n        {\n            StbNode nodeStart = nodes.FirstOrDefault(n => n.id == columns[i].id_node_bottom);\n            StbNode nodeEnd = nodes.FirstOrDefault(n => n.id == columns[i].id_node_top);\n\n            pts[i, 0] = new Point3d(nodeStart.X, nodeStart.Y, nodeStart.Z);\n            pts[i, 1] = new Point3d(nodeEnd.X, nodeEnd.Y, nodeEnd.Z);\n            lines[i] = new Line(pts[i, 0], pts[i, 1]);\n\n            idSection[i] = columns[i].id_section;\n        }\n\n        StbSections sections = model.StbModel.StbSections;\n\n        for (var i = 0; i < idSection.Length; i++)\n        {\n            var hasName = false;\n\n            if (sections.StbSecColumn_RC != null)\n            {\n                foreach (StbSecColumn_RC columnRc in sections.StbSecColumn_RC)\n                {\n                    if (columnRc.id != idSection[i]) continue;\n                    sectionNames[i] = columnRc.name;\n                    hasName = true;\n                    break;\n                }\n            }\n\n            if (sections.StbSecColumn_S != null && !hasName)\n            {\n                foreach (StbSecColumn_S columnS in sections.StbSecColumn_S)\n                {\n                    if (columnS.id != idSection[i]) continue;\n                    sectionNames[i] = columnS.name;\n                    break;\n                }\n            }\n        }\n\n        pt = pts;\n        line = lines;\n        name = sectionNames;\n    }\n}\n")),(0,a.kt)("p",null,"The results are shown below. I used the data in the HoaryFox Sample folder to create the diagram."),(0,a.kt)("p",null,"I used the CurveMiddle component to get the midpoint of each line, and assigned a tag to that point using TextTag.\nSince the model is the result of cross-sectional optimization using Grasshopper and Karamba3D, there are many cross-sections, which are shown in the figure."),(0,a.kt)("p",null,(0,a.kt)("img",{loading:"lazy",src:t(4972).Z,width:"650",height:"251"})))}h.isMDXComponent=!0},4972:function(e,n,t){n.Z=t.p+"assets/images/column&tag-a68e9e20a37340c6880de90e2f62fb63.png"}}]);